оказывается полезно описывать технологии

-----------------------------------------------------------
- технологии построения графиков
-----------------------------------------------------------

для первичного построения используется модуль
в базовом модуле нет свечей и баров, остальное вроде как устраивает
use Chart::Lines ;

для построения свечей и баров используется модуль https://metacpan.org/dist/GD-Graph-ohlc/view/ohlc.pod
к нему есть вопросы - не выбирается разный цвет растущих и падающих индикаторов и толщина линий, но лучше пока ничего не найдено, хотя искали
use GD::Graph::candlesticks ;
use GD::Graph::ohlc ;




-----------------------------------------------------------
-----------------------------------------------------------
- архитектура модуля ретроспективного анализа
-----------------------------------------------------------
-----------------------------------------------------------
задумана так:

шаг 1. из трёх таблиц первички OHLS 1M 1H 1D рассчитываются отдельные таблицы ретроспективных цен для каждого ТФ, с возможностью дозаполнения
       реализовано это функцией заполнения для указанной пары монет и таймфрэйм за указанный период, и вызывающей её функции - драйвера
       статус: этот этап к августу 2024 года реализован, но после выправления сбоя в первичке требуется перезаливка именно битка на основании 1D
       UPD к октябрю 2024. данные битка за проблемный период перезалиты
       статус: считаем этап реализованым

шаг 2. из отдельных таблиц ретроспективных цен для каждого ТФ в отдельные таблицы индикаторов, содержащие все ТФ и дополнительные параметры,
       расчитываются все расчётные значения индикатора и промежуточных данных
       в настоящее время запланированы таблицы для RSI, MACD, EMA стандартных формул расчёта и нестандартных из более мелких ТФ,
         - чтобы получать сигналы быстрее и не терять часть движения цены
       также возможно будут реализованы иные индикторы и их ретроспектива - Боллинджер, Аллигатор и т.п.
       статус: в части стандартных ТФ считаем этап реализованым
               в части НЕстандартных ТФ отложено до решения первой глобальной задачи - проверки стратегий торговли по комплексным индикаторам

шаг3. из таблиц ретроспективы индикаторов расчитываются события и состояния индикаторов
       статус: не начато

шаг 4. отдельной логикой расчитываются совокупности событий, для того, чтобы сопоставить точки появления таких совокупностей событий с ценой,
       - и проанализировать прибыльность совокупностей событий входа и выхода
       статус: не начато

Собственно такой модуль аналитики и позволит принять решение о применимости индикаторной торговли, 
 т.к. аналитика по событиям одного только индикатора - в частости и RSI (визуально), и событий MACD (изменение гистограммы, изменение линии
 MACD, пересечение линий MACD) в виде расчётов !!! показало неприменимость такой методики для получения прибыльной торговли !!!

Решаемые модулем задачи: тут считаем есть три вопроса 
1 - применима ли индикаторная торговля, какие наборы событий оптимальны если применима, 
2 - как удержать часть хода цены, которая уходит, пока мы ждём данных для расчёта и ндикаторов и событий. Тут думаю для EMA based индикаторов
    можно эмулировать получение MA из данных более мелких ТФ. Это позволит получать значения индикаторов раньше, и искать события быстрее
3 - насколько интересны для такой событийно - индикаторной торговли альты, дающие, как ни крути, большую волатильность ? С учетом управляемости
    альтов биткоином и маркетмэйкером стоит учитывать и важность безплечевой торговли, и выставление защитных ордеров, и определение
    фаз рынка - в .ч. вертолётных вероятностей

-----------------------------------------------------------
- в части расчёта ретроспективного RSI текущая итерация 3
-----------------------------------------------------------

- первая итерация
вызывала функцию, отдающую для указанной пары монет все расчётные значения RSI за требуемый период
функция вызывалась процедурой - драйвером, реализуя полный помесячный послойный расчёт монет, а также последние месяцы и дни
однако в силу недочёта, указания numeric без глубины, заполнение оказалось оченьь объёмным, сожрав полтерабайта

- вторая итерация
использовала функцию обработки отдельной записи, как в первичке
в самой таблице выправили numeric(42,21) а где надо - меньше или вообще integer
далее функцию обработки отдельной записи вызывала функция расчета за период для пары монет, как в первой итерации, а ее функция драйвер
в результате работало медленно и постоянно падало

- третья итерация
вернулись к первому варианту, но выправили таблицу и саму функцию отдачи табличных данных, урезав глубину полей до 42,21
в друйвере кроме помесячно - послойного реализовали расчёт всех записей для каждой монеты одним проходом ...
также пришлось реализовать обвязку BEGIN .. EXCEPTION .. END для самой операции MERGE, т.к. даже глубины numeric(42,21) для отдельных монет не хватает и операция падает без обработки исключений
этот вариант на 2024-09-07 тестируется

-----------------------------------------------------------
- в части расчёта ретроспективного MACD и EMA
-----------------------------------------------------------

они просто реализованы по нашим основным формулам, что и оперативные графики. 
!!!ВАЖНО!!! Однако добавлено хранение промежуточных значений, и БД распухла до 180Гб - это придётся оптимизировать

-----------------------------------------------------------
- в части выявления событий по заполненным индикаторам
-----------------------------------------------------------

- считаем, что заполнятьь нужно отдельно две колонки - событий и состояний индикатора для каждого ТФ

- перечень событий и состояний для RSI
RSI события [07]: без событий, пересёк верхний лимит вверх, пересёк верхний лимит вниз, пересёк нижний лимит вниз, пересёк нижний лимит вверх, перевёк середину вверх, пересёк середину вниз
RSI состояния [02]: идёт вверх, идёт вниз

- перечень событий и состояний для MACD line
MACD line события [05]: без событий, разворот вверх, разворот вниз, пересечение вверх, пересечение вниз
MACD line состояния [03]: идёт вниз, идёт наверх, флэтит

- перечень событий и состояний для MACD gist
MACD gist события [03]: без событий, разворот вверх, разворот вниз
MACD gist состояния [03]: идёт вниз, идёт наверх, флэтит

- перечень событий и состояний для EMA
EMA события [03]: без событий, разворот вверх, разворот вних
EMA состояния [03]: идёт вниз, идёт наверх, флэтит - для каждой из 8 EMA

- перечень событий и состояний для цены. Пока это не реализуем, но вообще задумка про взаимодействие с EMA
OHLC события: без событий, пока не определены
OHLC состояния: пока не определены


